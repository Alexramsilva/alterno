# -*- coding: utf-8 -*-
"""Alterno.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1pvi_VpyUhdYtpxI8dBBWBOycxVrVxo96
"""

import streamlit as st
import yfinance as yf
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

st.set_page_config(layout="wide")
st.title("Modelo del Resorte de Hooke aplicado al Precio")

# === 1. Menú desplegable ===
TICKERS = ["BTC-USD", "GAPB.MX", "PLTR", "SPY", "GRUMAB.MX", "FMTY14.MX", "IAU"]

ticker = st.selectbox(
    "Selecciona un activo:",
    TICKERS
)

# === 2. Descargar datos ===
df = yf.download(ticker, period="ytd", interval="1d")

if df.empty:
    st.error("No se pudieron descargar datos del activo seleccionado.")
    st.stop()

# === 3. Calcular medias móviles ===
df["MA5"] = df["Close"].rolling(5).mean()
df["MA10"] = df["Close"].rolling(10).mean()
df.dropna(inplace=True)

# === 4. Señales de entrada/salida ===
df["Signal"] = np.where(df["MA5"] > df["MA10"], 1, 0)
df["Crossover"] = df["Signal"].diff()

# === 5. Modelo del resorte ===
close_values = df["Close"].values.flatten()
ma10_values = df["MA10"].values.flatten()

df["x"] = close_values - ma10_values
k = 0.001
df["Force"] = -k * df["x"]

# === 6. Umbral (resorte tenso) ===
threshold = df["x"].std() * 1.5
df["Exit"] = np.where(abs(df["x"]) > threshold, 1, 0)

df["Exit_diff"] = df["Exit"].diff()

exit_dates = df[(df["Exit_diff"] == 1) & (df["MA5"] > df["MA10"])].index
entry_dates = df[(df["Exit_diff"] == -1) & (df["MA5"] < df["MA10"])].index

# === 7. Gráfico ===
fig, ax1 = plt.subplots(figsize=(12, 6))

ax1.plot(df["Close"], label="Precio", color="black", linewidth=1)
ax1.plot(df["MA10"], label="Media